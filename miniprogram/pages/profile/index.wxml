<view class="page">
  <view class="card user-info">
    <view class="user-header">
      <!-- 使用 chooseAvatar 方式获取头像 -->
      <button wx:if="{{!userInfo.nickName}}" class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
        <image class="avatar" src="{{userInfo.avatarUrl || '/images/avatar.png'}}" mode="aspectFill"></image>
      </button>
      <image wx:else class="avatar" src="{{userInfo.avatarUrl || '/images/avatar.png'}}" mode="aspectFill"></image>
      
      <!-- 昵称输入框 -->
      <input wx:if="{{!userInfo.nickName}}" class="nickname-input" type="nickname" placeholder="请输入昵称" value="{{tempNickName}}" bindinput="onNickNameInput" confirm-type="done"></input>
      <view wx:else class="user-name">{{userInfo.nickName || '未登录'}}</view>
      
      <!-- 保存按钮：当选择了头像或输入了昵称后显示 -->
      <button wx:if="{{!userInfo.nickName && (tempNickName || tempAvatarUrl)}}" class="save-btn" bindtap="handleSaveUserInfo" hover-class="save-btn-hover" type="default" size="default">保存信息</button>
    </view>
  </view>

  <view class="card">
    <view class="title">我的战绩</view>
    <view wx:if="{{!userInfo.nickName}}" class="empty-tip">请先完善个人信息以查看战绩</view>
    <view wx:else class="grid">
      <view class="stat">
        <view class="label">对局数</view>
        <view class="value">{{stats.games}}</view>
      </view>
      <view class="stat">
        <view class="label">胜场</view>
        <view class="value">{{stats.wins}}</view>
      </view>
      <view class="stat">
        <view class="label">连胜</view>
        <view class="value">{{stats.streak}}</view>
      </view>
      <view class="stat">
        <view class="label">常用难度</view>
        <view class="value">{{stats.bestAi}}</view>
      </view>
    </view>
  </view>

  <view class="card">
    <view class="title">最近对局</view>
    <view wx:if="{{!userInfo.nickName}}" class="empty-tip">请先完善个人信息以查看最近对局</view>
    <view wx:elif="{{recent.length === 0}}" class="empty-tip">暂无对局记录</view>
    <view wx:else class="list">
      <block wx:for="{{recent}}" wx:key="opponent">
        <view class="item">
          <view>
            <view class="name">对手：{{item.opponent}}</view>
            <view class="sub">步数 {{item.moves}}</view>
          </view>
          <view class="result {{item.result === '胜' ? 'win' : 'lose'}}">{{item.result}}</view>
        </view>
      </block>
    </view>
  </view>
</view>
